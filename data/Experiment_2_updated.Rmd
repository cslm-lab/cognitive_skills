---
title: "Experiment 2 Paper"
output: html_document
---

```{r setup, include=FALSE}
# load packages
x <- c("tidyverse","cowplot","lme4","afex","ggthemes","data.table",
       "kableExtra","BayesFactor","bayestestR","corrr","modelsummary")
lapply(x, FUN = function(X) {
  do.call("require", list(X)) 
})
knitr::opts_chunk$set(echo = TRUE)
theme_set(theme_few(base_size = 10))
```

# Reanalysis of Experiment 1 data
## Question 1: Do tests cognitive skills discriminate participants well (i.e., do we have a wide range of scores)? 

We get ceiling effects for CCPT (see also descriptive stats below), so we do not use this measure in further analyses.

```{r Exp 1 data wrangling, include=FALSE}
# Reanalysis of Experiment 1 individual differences----
#setwd("/Users/pamelafuhrmeister/Dropbox/Postdoc_projects/SFB/Experiment_2/Data/")

df <- read.csv("Results_PWI_EEG_20200526.csv", sep=";")
colnames(df)[1] <- "Participant"
ccpt <- fread("Experience_01_CCPT.csv", select = c("sujet", "Hit_rate"))
colnames(ccpt) <- c("Participant", "CCPT")
ccpt <- distinct(ccpt)
ctet <- fread("CTET_Results.csv", select = c("Participant", "Hit"))
colnames(ctet)[2] <- "CTET"
ospan <- fread("OSpan_Results.csv", select = c("Participant", "Mean_Block"))
colnames(ospan)[2] <- "OSpan"
rotspan <- fread("RotSpan_Results.csv", select = c("Participant", "Mean_Block"))
colnames(rotspan)[2] <- "RotSpan"
symspan <- fread("SymSpan_Results.csv", select = c("Participant", "Mean_Block"))
colnames(symspan)[2] <- "SymSpan"
ssrt <- fread("StopSignal_Results.csv", select = c("Participant", "Mean_SSRTi"))
colnames(ssrt)[2] <- "SSRT"

# simon <- read.csv("Experience_01_Simon_R.csv")
# flanker <- read.csv("Flanker_Result_merged.csv")

# flanker_slopes <- flanker %>%
#   filter(acc == 1)
# flanker_slopes <- RTconflict::inhib.delta(flanker_slopes$rt, flanker_slopes$compatible, sujet = flanker_slopes$sujet, cond = NA, dquantile = 5, type = 7)
# 
# flanker_slopes2 <- flanker_slopes[2]$delta.slope
# flanker_slopes2 <- flanker_slopes2[1:2]
# colnames(flanker_slopes2) <- c("Participant", "Flanker_slope")
# 
# simon_slopes <- simon %>%
#   filter(acc == 1)
# simon_slopes <- RTconflict::inhib.delta(simon_slopes$rt, simon_slopes$compatible, sujet = simon_slopes$sujet, cond = NA, dquantile = 5, type = 7)
# 
# simon_slopes2 <- simon_slopes[2]$delta.slope
# simon_slopes2 <- simon_slopes2[1:2]
# colnames(simon_slopes2) <- c("Participant", "Simon_slope")

mycenter <- function(x){
  scale(x, center = TRUE, scale = FALSE)
  }

Accuracy <- as.factor(as.character(df$Response_Trial))
df$Participant <- as.factor(as.character(df$Participant))

df$Trial.position <- as.numeric(as.character(df$Picture_ID_Multipic))
df$Picture  <- as.factor(as.character(df$Trigger_Picture))

df$Comment <- as.factor(as.character(df$Response_Trial))
df$Condition <- as.factor(as.character(df$Trigger_Condition))
df$Condition <- plyr::mapvalues(df$Condition, from = c("101", "102", "103","104","105"), to = c("baseline","phono.rel", "phono.unr", "sem.rel", "sem.unr"))
df$Condition <- as.factor(as.character(df$Condition))

nrow(df)

table(df$Response_Trial)

df2b <- df[df$Response_Trial=="correct",]
nrow(df2b)
nrow(df2b)-nrow(df)

nrow(df) - nrow(df2b)

df2b <- df2b[df2b$RT < 2301,]

df3 <- df2b[!is.na(df2b$RT),]

df3 <- df3 %>% select(Participant, RT, Condition, Picture, Flanker_RT_cost, Simon_RT_cost)

df4 <- merge(merge(merge(merge(merge(merge(
  df3,
  ccpt,),
  ctet,),
  ospan,),
  symspan,),
  rotspan,),
  ssrt, by = "Participant")

cog_skills <- df4 %>%
  select(c(1,5:12)) %>%
  distinct(.) %>%
  pivot_longer(., cols = 2:9, names_to = "measure", values_to = "score")

```

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
ggplot(cog_skills, aes(x = score, fill = measure)) +
  geom_histogram(bins = 40) +
  facet_wrap(~measure, scales = "free", nrow = 2) +
  labs(x = "Score", y = "Count") +
  scale_fill_viridis_d("measure") +
  theme(legend.position = "none") +
  theme(plot.margin = unit(c(.25,.25,.25,.25), "cm")) #+ 
  #theme(panel.grid.major = element_line(color = "lightgray"))

#ggsave("figure_histogram.pdf", width = 18, height = 10, units = "cm")
```

## 1a: Descriptive statistics of cognitive measures

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
dsc <- cog_skills %>%
  select(-Participant) %>%
  group_by(measure) %>%
  summarize(mean = round(mean(score),2))

dsc_sd <- cog_skills %>%
  select(-Participant) %>%
  group_by(measure) %>%
  summarize(sd = round(sd(score),2))

dsc <- merge(dsc, dsc_sd, by = "measure")
colnames(dsc)[1] <- "Measure"

kbl(dsc, escape = FALSE) %>%
  kable_styling()

```


## 1b: Do cognitive skills correlate with each other?
Highlighted r values are significant at p < .05 with no correction for multiple comparisons. We found no significant correlations between measures.

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
cog_skills2 <- df4 %>%
  filter(Condition == "baseline") %>%
  select(c(1,5:12)) %>%
  distinct(.)

cor_cog <- psych::corr.test(cog_skills_2[,c(2:9)])

cor_r <- data.frame(cor_cog$r)
cor_p <- data.frame(cor_cog$p)
#correlations_cog <- datasummary_correlation_format(cor_cog, fmt = 2)
#pvalues_cog <- data.frame(psych::corr.test(cor_cog)$p)
  
# for (i in 1:nrow(correlations_cog)) {
#   for (j in 1:ncol(correlations_cog)) {
#     if (pvalues_cog[i, j] < 0.05 && i != j) {
#       correlations_cog[i, j] <- cell_spec(correlations_cog[i, j], background = "yellow")
#     }
#   }
# }
# 
# kbl(correlations_cog, escape = FALSE) %>%
#   kable_styling()

```



## Question 2: Do cognitive skills correlate with ex-gaussian parameters of RT distribution (baseline condition only)? 

```{r include=FALSE}
exgaussian <- df4 %>%
  filter(Condition == "baseline") %>%
  group_by(Participant) %>%
  group_modify(~ broom::tidy(retimes::mexgauss(.$RT, n = length(.$RT)))) %>%
  pivot_wider(names_from = names, values_from = x)

exgauss_cogskills <- merge(cog_skills2[,c(1:3,5:9)], exgaussian, by = "Participant")

exgauss_cogskills[2:8] <- lapply(exgauss_cogskills[2:8], mycenter)

dat <- exgauss_cogskills[2:11]

# compute correlations and format them
# correlations <- data.frame(cor(dat))
# correlations <- datasummary_correlation_format(correlations, fmt = 2)
# pvalues <- data.frame(psych::corr.test(dat)$p)

df_bf <- data.frame(bf = numeric(),
                    error = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)

df_CI <- data.frame(Parameter = character(),
                    Mean = numeric(),
                    CI = numeric(),
                    CI_low = numeric(),
                    CI_high = numeric(),
                    pd = numeric(),
                    ROPE_CI = numeric(),
                    ROPE_low = numeric(),
                    ROPE_high = numeric(),
                    ROPE_Percentage = numeric(),
                    Prior_Distribution = character(),
                    Prior_Location = numeric(),
                    Prior_Scale = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)


for(i in 1:ncol(dat[1:7])) {       # for-loop over columns
  data <- dat[,c(i,8)]
  bf_cor_mu <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_mu$var1 <- colnames(data[1])
  bf_cor_mu$exgaus_par <- colnames(data[2])
  bf_cor_mu <- bf_cor_mu[,c(1:2,5:6)]
  df_bf <- rbind(df_bf, bf_cor_mu)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI <- rbind(df_CI, posterior)
}

for(i in 1:ncol(dat[1:7])) {       # for-loop over columns
  data <- dat[,c(i,9)]
  bf_cor_sig <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_sig$var1 <- colnames(data[1])
  bf_cor_sig$exgaus_par <- colnames(data[2])
  bf_cor_sig <- bf_cor_sig[,c(1:2,5:6)]
  df_bf <- rbind(df_bf, bf_cor_sig)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI <- rbind(df_CI, posterior)
}

for(i in 1:ncol(dat[1:7])) {       # for-loop over columns
  data <- dat[,c(i,10)]
  bf_cor_tau <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_tau$var1 <- colnames(data[1])
  bf_cor_tau$exgaus_par <- colnames(data[2])
  bf_cor_tau <- bf_cor_tau[,c(1:2,5:6)]
  df_bf <- rbind(df_bf, bf_cor_tau)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI <- rbind(df_CI, posterior)
}

# correlations <- correlations %>%
#   select(c(1:7)) %>%
#   slice_tail(n = 3)
# 
# pvalues <- pvalues %>%
#   select(c(1:7)) %>%
#   slice_tail(n = 3)
  
# for (i in 1:nrow(correlations)) {
#   for (j in 1:ncol(correlations)) {
#     if (pvalues[i, j] < 0.05 && i != j) {
#       correlations[i, j] <- cell_spec(correlations[i, j], background = "yellow")
#     }
#   }
# }
# return(correlations)
# }

```

Mean and credible intervals of posterior distributions

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
# correlations <- correlations %>%
#   mutate(Parameter = rownames(.))
# correlations <- correlations[c(1,3),c(8,1:7)]
# kbl(correlations, escape = FALSE) %>%
#   kable_styling()

kbl(df_CI, escape = FALSE) %>%
  kable_styling()

```

Bayes factors in favor of the alternative hypothesis

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
# correlations <- correlations %>%
#   mutate(Parameter = rownames(.))
# correlations <- correlations[c(1,3),c(8,1:7)]
# kbl(correlations, escape = FALSE) %>%
#   kable_styling()
rownames(df_bf)<-NULL
kbl(df_bf, escape = FALSE) %>%
  kable_styling()

```

# Experiment 2 data
## Question 1: Replicate reanalysis of Exp. 1 in a hypothesis-driven way (using slow block only)

```{r Exp 2 data wrangling, include=FALSE}
exp2 <- read.csv("Experiment_2_data.csv", sep=",")

exp2$Accuracy <- as.factor(as.character(exp2$Response_Trial))
exp2$Participant <- as.factor(as.character(exp2$Participant_ID))

exp2$Picture  <- as.factor(as.character(exp2$Picture_ID))

exp2$Comment <- as.factor(as.character(exp2$Response_Trial))
exp2$Condition <- as.factor(as.character(exp2$Condition_ID))
exp2$Condition <- plyr::mapvalues(exp2$Condition, from = c("9001", "9002", "9003","9004","9005"), to = c("baseline","phono.rel", "phono.unr", "sem.rel", "sem.unr"))
exp2$Condition <- as.factor(as.character(exp2$Condition))
exp2$Speed <- ifelse(exp2$Type_Speed == 3001, "normal", "fast")

df5 <- exp2 %>%
  filter(Response_Trial == "correct", RT != "NA")

df5 <- df5 %>%
  mutate(block = case_when(
  Type_Presentation %in% c(4001,4002) && Set_Nbr == 5001 ~ "block_1",
  Type_Presentation %in% c(4003,4004) && Set_Nbr == 5002 ~ "block_1",
  Type_Presentation %in% c(4001,4002) && Set_Nbr == 5002 ~ "block_2",
  Type_Presentation %in% c(4003,4004) && Set_Nbr == 5001 ~ "block_2",
  )
)
df5$block <- as.factor(df5$block)

cog_skills_exp2 <- df5 %>%
  select(c("Participant", "Ospan_PCU", "Symspan_PCU", "Rotspan_PCU", "CCPT_Hit_rate", "CTET_Hit_rate", "Flanker_Cost", "Simon_Cost", "SSRTi")) %>%
  distinct(.)
cog_skills_exp2_long <- cog_skills_exp2 %>% pivot_longer(., cols = 2:9, names_to = "measure", values_to = "score")
```

Histogram of scores. They look pretty similar to Experiment 1. (The participant with the really low CCPT hit rate was not the same person with low scores on other tasks.)

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
ggplot(cog_skills_exp2_long, aes(x = score, fill = measure)) +
  geom_histogram(bins = 40) +
  facet_wrap(~measure, scales = "free", nrow = 2) +
  labs(x = "Score", y = "Count") +
  scale_fill_viridis_d("measure") +
  theme(legend.position = "none") +
  theme(plot.margin = unit(c(.25,.25,.25,.25), "cm"))

# ggsave("figure_histogram_exp2.pdf", width = 18, height = 10, units = "cm")
```


```{r}
ggpairs(cog_skills_exp2,
        columns = 2:9,
        upper = list(continuous = wrap("cor", size = 2.5)),
        lower = list(continuous = "smooth"),
        diag = list(continuous = "blankDiag"))
```


```{r include=FALSE}
exgaussian2 <- df5 %>%
  filter(Condition == "baseline") %>%
  filter(Speed == "normal") %>%
  group_by(Participant) %>%
  group_modify(~ broom::tidy(retimes::mexgauss(.$RT, n = length(.$RT)))) %>%
  pivot_wider(names_from = names, values_from = x)

exgauss_cogskills_exp2 <- merge(cog_skills_exp2[,c(1:4,6:9)], exgaussian2, by = "Participant")

exgauss_cogskills_exp2[2:8] <- lapply(exgauss_cogskills_exp2[2:8], mycenter)

dat2 <- exgauss_cogskills_exp2[2:11]

# # compute correlations and format them
# correlations <- data.frame(cor(dat))
# correlations <- datasummary_correlation_format(correlations, fmt = 2)
# pvalues <- data.frame(psych::corr.test(dat)$p)
# 
# correlations <- correlations %>%
#   select(c(1:7)) %>%
#   slice_tail(n = 3)
# 
# pvalues <- pvalues %>%
#   select(c(1:7)) %>%
#   slice_tail(n = 3)
#   
# for (i in 1:nrow(correlations)) {
#   for (j in 1:ncol(correlations)) {
#     if (pvalues[i, j] < 0.05 && i != j) {
#       correlations[i, j] <- cell_spec(correlations[i, j], background = "yellow")
#     }
#   }
# }
# return(correlations)
# }

df_bf_2 <- data.frame(bf = numeric(),
                    error = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)

df_CI_2 <- data.frame(Parameter = character(),
                    Mean = numeric(),
                    CI = numeric(),
                    CI_low = numeric(),
                    CI_high = numeric(),
                    pd = numeric(),
                    ROPE_CI = numeric(),
                    ROPE_low = numeric(),
                    ROPE_high = numeric(),
                    ROPE_Percentage = numeric(),
                    Prior_Distribution = character(),
                    Prior_Location = numeric(),
                    Prior_Scale = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)


for(i in 1:ncol(dat2[1:7])) {       # for-loop over columns
  data <- dat2[,c(i,8)]
  bf_cor_mu <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_mu$var1 <- colnames(data[1])
  bf_cor_mu$exgaus_par <- colnames(data[2])
  bf_cor_mu <- bf_cor_mu[,c(1:2,5:6)]
  df_bf_2 <- rbind(df_bf_2, bf_cor_mu)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_2 <- rbind(df_CI_2, posterior)
}

for(i in 1:ncol(dat2[1:7])) {       # for-loop over columns
  data <- dat2[,c(i,9)]
  bf_cor_sig <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_sig$var1 <- colnames(data[1])
  bf_cor_sig$exgaus_par <- colnames(data[2])
  bf_cor_sig <- bf_cor_sig[,c(1:2,5:6)]
  df_bf_2 <- rbind(df_bf_2, bf_cor_sig)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_2 <- rbind(df_CI_2, posterior)
}

for(i in 1:ncol(dat2[1:7])) {       # for-loop over columns
  data <- dat2[,c(i,10)]
  bf_cor_tau <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_tau$var1 <- colnames(data[1])
  bf_cor_tau$exgaus_par <- colnames(data[2])
  bf_cor_tau <- bf_cor_tau[,c(1:2,5:6)]
  df_bf_2 <- rbind(df_bf_2, bf_cor_tau)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_2 <- rbind(df_CI_2, posterior)
}

```

Mean and credible intervals of posterior distribution

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
# correlations <- correlations %>%
#   mutate(Parameter = rownames(.))
# correlations <- correlations[c(1,3),c(8,1:7)]
kbl(df_CI_2, escape = FALSE) %>%
  kable_styling()
```

Bayes factors in favor of the alternative hypothesis
```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
rownames(df_bf_2)<-NULL
kbl(df_bf_2, escape = FALSE) %>%
  kable_styling()
```


```{r include=FALSE}
exgaussian3 <- df5 %>%
  filter(Condition == "baseline") %>%
  filter(Speed == "fast") %>%
  group_by(Participant) %>%
  group_modify(~ broom::tidy(retimes::mexgauss(.$RT, n = length(.$RT)))) %>%
  pivot_wider(names_from = names, values_from = x)

exgauss_cogskills_exp2_fast <- merge(cog_skills_exp2[,c(1:4,6:9)], exgaussian3, by = "Participant")

exgauss_cogskills_exp2_fast[2:8] <- lapply(exgauss_cogskills_exp2_fast[2:8], mycenter)

dat3 <- exgauss_cogskills_exp2_fast[2:11]

df_bf_3 <- data.frame(bf = numeric(),
                    error = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)

df_CI_3 <- data.frame(Parameter = character(),
                    Mean = numeric(),
                    CI = numeric(),
                    CI_low = numeric(),
                    CI_high = numeric(),
                    pd = numeric(),
                    ROPE_CI = numeric(),
                    ROPE_low = numeric(),
                    ROPE_high = numeric(),
                    ROPE_Percentage = numeric(),
                    Prior_Distribution = character(),
                    Prior_Location = numeric(),
                    Prior_Scale = numeric(),
                    var1 = character(),
                    exgaus_par = character(),
                    stringsAsFactors=FALSE)


for(i in 1:ncol(dat3[1:7])) {       # for-loop over columns
  data <- dat3[,c(i,8)]
  bf_cor_mu <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_mu$var1 <- colnames(data[1])
  bf_cor_mu$exgaus_par <- colnames(data[2])
  bf_cor_mu <- bf_cor_mu[,c(1:2,5:6)]
  df_bf_3 <- rbind(df_bf_3, bf_cor_mu)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_3 <- rbind(df_CI_3, posterior)
}

for(i in 1:ncol(dat3[1:7])) {       # for-loop over columns
  data <- dat3[,c(i,9)]
  bf_cor_sig <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_sig$var1 <- colnames(data[1])
  bf_cor_sig$exgaus_par <- colnames(data[2])
  bf_cor_sig <- bf_cor_sig[,c(1:2,5:6)]
  df_bf_3 <- rbind(df_bf_3, bf_cor_sig)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_3 <- rbind(df_CI_3, posterior)
}

for(i in 1:ncol(dat3[1:7])) {       # for-loop over columns
  data <- dat3[,c(i,10)]
  bf_cor_tau <- data.frame(correlationBF(data[,1],data[,2]))
  bf_cor_tau$var1 <- colnames(data[1])
  bf_cor_tau$exgaus_par <- colnames(data[2])
  bf_cor_tau <- bf_cor_tau[,c(1:2,5:6)]
  df_bf_3 <- rbind(df_bf_3, bf_cor_tau)
  posterior <- data.frame(describe_posterior(correlationBF(data[,1],data[,2]), centrality = "mean"))
  posterior$var1 <- colnames(data[1])
  posterior$exgaus_par <- colnames(data[2])
  df_CI_3 <- rbind(df_CI_3, posterior)
}

```

## Question 2: Do we see stronger relationships between cog. skills and word production speed when the task is more difficult (speeded task)?

Mean and credible intervals of posterior distribution

```{r echo=FALSE, warning=FALSE, echo=FALSE, message=FALSE}
# correlations <- correlations %>%
#   mutate(Parameter = rownames(.))
# correlations <- correlations[c(1,3),c(8,1:7)]
kbl(df_CI_3, escape = FALSE) %>%
  kable_styling()
```

Bayes factors in favor of the alternative hypothesis: We really don't have evidence for anything (no evidence for correlations or for null)

```{r echo=FALSE, warning=FALSE, message=FALSE}
rownames(df_bf_3)<-NULL
kbl(df_bf_3, escape = FALSE) %>%
  kable_styling()
```

## Question 3: Do participants show smaller semantic interference effects when we force them to respond faster?

It doesn't look like it. We didn't get an interaction between speed block and condition. There was an interaction between the semantic interference effect and block order, but the effect was significant for both block orders, just larger in the participants who got the fast block first (which seems counterintuitive). 

I then ran the models without block order.


```{r warning=FALSE, message=FALSE}
df5 <- df5 %>%
  mutate(block_order = case_when(
  Type_Presentation %in% c(4002,4004) ~ "fast_first",
  Type_Presentation %in% c(4001,4003) ~ "normal_first",
  )
)

df5_sem <- droplevels(subset(df5, Condition %in% c("sem.unr","sem.rel")))
contrasts(df5_sem$Condition) <- rbind(-.5,.5)
df5_sem$block_order <- as.factor(df5_sem$block_order)
contrasts(df5_sem$block_order) <- rbind(-.5,.5)
df5_sem$Speed <- as.factor(df5_sem$Speed)
contrasts(df5_sem$Speed) <- rbind(-.5,.5)

m0 <- lmer(RT~Speed+Condition+block_order+(1|Picture)+(1|Participant_ID), data=df5_sem)
mat_trt <- model.matrix(m0)
head(mat_trt)
df5_sem$Speed.cont <- mat_trt[,2]
df5_sem$Condition.cont <- mat_trt[,3]
df5_sem$block_order.cont <- mat_trt[,4]

m1 <- lmer(RT~Speed.cont*Condition.cont*block_order.cont + (1+Speed.cont*Condition.cont*block_order.cont||Picture)+(1+Speed.cont*Condition.cont||Participant_ID), data = df5_sem)

m1b <- lmer(RT~Speed.cont*Condition.cont*block_order.cont + (1+Speed.cont*Condition.cont*block_order.cont||Picture)+(1+Speed.cont*Condition.cont||Participant_ID), data = df5_sem[abs(scale(resid(m1)))<2.5,])
print(summary(m1b, corr=F))

m1c <- lmer(RT~block_order/(Speed.cont*Condition.cont) + (1+block_order.cont/(Speed.cont*Condition.cont)||Picture)+(1+Speed.cont*Condition.cont||Participant_ID), data = df5_sem[abs(scale(resid(m1)))<2.5,])
print(summary(m1c, corr=F))

m2 <- lmer(RT~Speed.cont*Condition.cont + (1+Speed.cont*Condition.cont||Picture)+(1+Speed.cont*Condition.cont||Participant_ID), data = df5_sem)

m2b <- lmer(RT~Speed.cont*Condition.cont + (1+Speed.cont*Condition.cont||Picture)+(1+Speed.cont*Condition.cont||Participant_ID), data = df5_sem[abs(scale(resid(m2)))<2.5,])
print(summary(m2b, corr=F))
```

## Question 4: Does attention interact with the semantic interference effect?

```{r warning=FALSE, message=FALSE}
m3 <- lmer(RT~Condition.cont*CTET_Hit_rate + (1+Condition.cont*CTET_Hit_rate||Picture)+(1+Condition.cont*CTET_Hit_rate||Participant_ID), data = df5_sem)

m3b <- lmer(RT~Condition.cont*CTET_Hit_rate + (1+Condition.cont*CTET_Hit_rate||Picture)+(1+Condition.cont*CTET_Hit_rate||Participant_ID), data = df5_sem[abs(scale(resid(m3)))<2.5,])
print(summary(m3b, corr=F))

```


## Question 5: Does distractor recall predict the magnitude of the semantic interference effect?

```{r warning=FALSE, message=FALSE}

m4 <- lmer(RT~Condition.cont*D_prime_Recall_Participant + (1+Condition.cont*D_prime_Recall_Participant||Picture)+(1+Condition.cont*D_prime_Recall_Participant||Participant_ID), data = df5_sem)

m4b <- lmer(RT~Condition.cont*D_prime_Recall_Participant + (1+Condition.cont*D_prime_Recall_Participant||Picture)+(1+Condition.cont*D_prime_Recall_Participant||Participant_ID), data = df5_sem[abs(scale(resid(m4)))<2.5,])
print(summary(m4b, corr=F))

```

